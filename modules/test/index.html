<!DOCTYPE html>
<html lang="en">
<head>
    <title>Test</title>

    <meta charset="utf-8" />
    <meta name="author" content="Cruncher" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width" />

    <script title="load">
        window.DEBUG = true;
        document.documentElement.className += ' js loading';
        // window.addEventListener('DOMContentLoaded', () => document.documentElement.classList.remove('content-loading'));
        // Wait for other load handlers to run first - Bolt does a few things on
        // load (eg. targetable scrolls) and we want them to run before the loading
        // class is removed
        window.addEventListener('load', () => window.requestAnimationFrame(() => document.documentElement.classList.remove('loading')));
    </script>

    <script type="importmap">{
        "imports": {
            "bolt/":       "../../../bolt/",
            "dom/":        "../../../dom/modules/",
            "fn/":         "../../../fn/modules/",
            "forms/":      "../../../form-elements/",
            "literal/":    "../../../literal/",
            "midi/":       "../../../midi/modules/",
            "soundstage/": "../../../soundstage/"
        }
    }</script>

    <style>
    @import '../../../bolt/elements/html.css';
    @import '../../../bolt/elements/form.css';
    @import '../../../bolt/elements/table.css';
    @import '../../../bolt/elements/type.css';
    @import '../../../bolt/elements/label.css';
    @import '../../../bolt/elements/form.css';
    @import '../../../bolt/elements/focus.css';
    @import '../../../bolt/elements/svg.css';
    @import '../../../bolt/classes/invisible.css';
    @import '../../../bolt/classes/block.css';
    @import '../../../bolt/classes/striped-table.css';
    @import '../../../bolt/classes/button.css';
    @import '../../../bolt/classes/thumb.css';
    @import '../../../bolt/classes/atoms.css';
    @import '../../../bolt/classes/text.css';
    @import '../../../bolt/classes/color.css';

    body { padding: 1.25rem; }
    </style>
</head>

<body class="3x-grid grid">
    <script type="module">
    import './events-test.js';
    </script>

    <h1>Test Soundstage</h1>
    <button type="button" value="" id="start">Start tests</button>

    <!--script type="module">
        import events     from '../../../dom/modules/events.js';
        import context    from '../context.js';
        import Soundstage from '../stage.js';

        const stage = Soundstage.from({
            objects: [/*{
                id: 1,
                type: 'tick',
                node: {},
                events: [
                    [0, 'note', 320, 0.5,  0.2],
                    [1, 'note', 240, 0.25, 0.2],
                    [2, 'note', 240, 0.25, 0.2],
                    [3, 'note', 240, 0.25, 0.2],
                ]
            }, */{
                id: 2,
                type: 'instrument',
                node: {
                    voice: {
                        nodes: [
                            { id: 'piano', type: 'samples', data: { src: 'https://sound.stephen.band/samples/steinway-piano/samples.json' } },
                            //{ id: 'tick', type: 'tick', data: { gain: '-36dB' } },
                            { id: 'mix', type: 'mix',  data: { gain: 1, pan: 0 } }
                        ],

                        connections: [
                            { source: 'piano', target: 'mix' },
                            //{ source: 'tick',  target: 'mix' }
                        ],

                        commands: [
                            { target: 'piano' }
                        ],

                        properties: {},
                        output: 'mix'
                    },

                    gain: 1
                },
                events: [
                    [0, 'note', 42, 0.75, 0.2],
                    [1, 'note', 49, 0.75, 0.2],
                    [2, 'note', 49, 0.75, 0.2],
                    [3, 'note', 49, 0.75, 0.2],
                    [4, 'note', 42, 0.75, 0.2],
                    [5, 'note', 49, 0.75, 0.2],
                    [6, 'note', 49, 0.75, 0.2],
                    [7, 'note', 49, 0.75, 0.2],
                    [8, 'note', 42, 0.75, 0.2],
                    [9, 'note', 49, 0.75, 0.2],
                    [10, 'note', 49, 0.75, 0.2],
                    [11, 'note', 49, 0.75, 0.2],
                ]
            }, {
                id:   'output',
                type: 'output',
                node: {
                    channels: [0,1]
                }
            }],

            connectors: [
                //[1, 'output'],
                [2, 'output']
            ]
        });



        /*const stage = Soundstage.from({
            objects: [{
                id: 1,
                type: 'tone',
                events: [
                    [0, 'sequence', 9, 0, 2]
                ],
                node: {
                    type: 'sine'
                }
            }, {
                id:   'output',
                type: 'output',
                node: {
                    channels: [0,1]
                }
            }],

            connectors: [
                [1, 'output']
            ],

            events: [
                // 180bpm
                [0, 'rate', 3]
            ],

            sequences: [{
                id: 9,
                events: [
                    // TODO: Should never be played - or should we play the tail end of it?
                    [-0.1, 'note', 80, 0, 0.2],
                    // Should be played
                    [0,   'note', 100, 0, 0.05],
                    [0.1, 'note', 200, 0, 0.2],
                    [0.2, 'param', 'gain', 0, 'exponential']
                ]
            }]
        });*/

        window.stage = stage;

        events('click', document.getElementById('start')).each((e) => {
            stage
            .start(context.currentTime + 0.4)
            .stop(context.currentTime + 15);
        });
    </script-->
</body>
</html>
